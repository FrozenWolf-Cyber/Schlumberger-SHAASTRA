articles= {'What is Energy?':['''
What is Energy?

The classical description of energy is the ability of a system to perform work, but as energy exists in so many forms, it is hard to find one comprehensive definition. It is the property of an object that can be transferred from one object to another or converted to different forms but cannot be created or destroyed. There are numerous sources of energy. In the next few sections, let us discuss the about different sources of energy in detail.
Sources Of Energy

Sources of energy can be classified into:

    Renewable Sources
    Non-renewable Sources

Renewable sources of energy are available plentiful in nature and are sustainable. These resources of energy can be naturally replenished and are safe for the environment.

Examples of renewable sources of energy are: Solar energy, geothermal energy, wind energy, biomass, hydropower and tidal energy.

A non-renewable resource is a natural resource that is found underneath the earth. These type of energy resources do not replenish at the same speed at which it is used. They take millions of years to replenish. The main examples of non-renewable resources are coal, oil and natural gas.

Examples of non-renewable sources of energy are: Natural gas, coal, petroleum, nuclear energy and hydrocarbon gas liquids.
Sources Of Energy
Difference Between Renewable and Non-renewable Sources of Energy
Renewable 	Non-renewable
The resources that can be renewed once they are consumed are called renewable sources of energy. 	The resources that cannot be renewed once they are consumed are called non-renewable sources of energy.
These resources do not cause any environmental pollution. 	These resources cause environmental pollution..
Renewable resources are inexhaustible. 	Non- Renewable resources are exhaustible.
Renewable resources are not affected by human activities. 	Non- Renewable resources are affected by human activities.
Examples of Renewable resources- Air, water and solar energy. 	Examples of Non-renewable resources- natural gas, coal and nuclear energy.
Natural Sources of Energy

During the stone age, it was wood. During the iron age, we had coal. In the modern age, we have fossil fuels like petroleum and natural gas. So how do we choose the source of energy?
Good sources of energy should have the following qualities:

    Optimum heat production per unit of volume/mass used
    Easy to transport
    Least Polluting
    Economical

Types of Natural Sources of Energy

There are two types of natural sources of energy classified by their popularity and use,

    Conventional Sources of Energy
    Non-Conventional Sources of Energy

Difference Between Conventional and Non-Conventional Sources of Energy
 Conventional 	 Non-conventional
These resources are exhaustible. 	These resources are inexhaustible.
These resources cause pollution as they emit smoke and ash. 	These resources are usually pollution-free.
These resources are very expensive to be maintained, stored and transmitted. 	These resources are less expensive for local use and can easily be maintained.
Examples- coal, natural gas, petroleum, and water power. 	Examples- solar, biomass, wind, biogas, and tidal, geothermal.

In this article, you learned about natural resources, energy sources, and what makes a good source of energy. Explore more such articles at BYJU’S, which provides detailed solutions to the questions of NCERT Book for the energy source so that one can compare their answers with the sample answers given for this chapter.
Frequently Asked Questions – FAQs
What sources of energy are renewable?
Following are the sources of energy that are renewable:

    Biomass energy
    Wind energy
    Tidal energy
    Hydro energy

What is the main source of energy in India?
When commercial purposes are considered coal, oil, and natural gas are the main source of energy in India.
What are the sources of energy in India?

Following are the sources of energy in India:

    Coal
    Natural gas
    Thermal energy
    Mineral oil

Can any source of energy be pollution-free?
No, the source of energy cannot be pollution-free as it affects the environment in some way. For example, solar energy can be considered pollution-free but the installation of the setup will cause damage to the environment.
What are the advantages and disadvantages of wind power?
Advantages:

    There are no harmful gases released into the environment.
    It is a way for the generation of revenue in the local communities.
    It is one of the clean sources of energy.

Disadvantages:

    The storage of energy needs to be improved.
    The initial setup requires a lot of investment.
    Numerous lands will be used up.

List the examples of sources of energy
Following are the examples of sources of energy:

    Biofuel energy
    Hydropower
    Geothermal energy
    Solar energy
    Nuclear energy
    Tidal energy
    Wind energy

''',"https://dmitripavlutin.com/javascript-fetch-async-await/"], 
'Nuclear energy ':[
'''
Nuclear energy is the energy in the nucleus, or core, of an atom. Atoms are tiny units that make up all matter in the universe, and energy is what holds the nucleus together. There is a huge amount of energy in an atom's dense nucleus. In fact, the power that holds the nucleus together is officially called the "strong force."

Nuclear energy can be used to create electricity, but it must first be released from the atom. In the process of nuclear fission, atoms are split to release that energy.

A nuclear reactor, or power plant, is a series of machines that can control nuclear fission to produce electricity. The fuel that nuclear reactors use to produce nuclear fission is pellets of the element uranium. In a nuclear reactor, atoms of uranium are forced to break apart. As they split, the atoms release tiny particles called fission products. Fission products cause other uranium atoms to split, starting a chain reaction. The energy released from this chain reaction creates heat.

The heat created by nuclear fission warms the reactor's cooling agent. A cooling agent is usually water, but some nuclear reactors use liquid metal or molten salt. The cooling agent, heated by nuclear fission, produces steam. The steam turns turbines, or wheels turned by a flowing current. The turbines drive generators, or engines that create electricity.

Rods of material called nuclear poison can adjust how much electricity is produced. Nuclear poisons are materials, such as a type of the element xenon, that absorb some of the fission products created by nuclear fission. The more rods of nuclear poison that are present during the chain reaction, the slower and more controlled the reaction will be. Removing the rods will allow a stronger chain reaction and create more electricity.

As of 2011, about 15 percent of the world's electricity is generated by nuclear power plants. The United States has more than 100 reactors, although it creates most of its electricity from fossil fuels and hydroelectric energy. Nations such as Lithuania, France, and Slovakia create almost all of their electricity from nuclear power plants.

Nuclear Food: Uranium

Uranium is the fuel most widely used to produce nuclear energy. That's because uranium atoms split apart relatively easily. Uranium is also a very common element, found in rocks all over the world. However, the specific type of uranium used to produce nuclear energy, called U-235, is rare. U-235 makes up less than one percent of the uranium in the world.

Although some of the uranium the United States uses is mined in this country, most is imported. The U.S. gets uranium from Australia, Canada, Kazakhstan, Russia, and Uzbekistan. Once uranium is mined, it must be extracted from other minerals. It must also be processed before it can be used.

Because nuclear fuel can be used to create nuclear weapons as well as nuclear reactors, only nations that are part of the Nuclear Non-Proliferation Treaty (NPT) are allowed to import uranium or plutonium, another nuclear fuel. The treaty promotes the peaceful use of nuclear fuel, as well as limiting the spread of nuclear weapons.

A typical nuclear reactor uses about 200 tons of uranium every year. Complex processes allow some uranium and plutonium to be re-enriched or recycled. This reduces the amount of mining, extracting, and processing that needs to be done.

Nuclear Energy and People

Nuclear energy produces electricity that can be used to power homes, schools, businesses, and hospitals. The first nuclear reactor to produce electricity was located near Arco, Idaho. The Experimental Breeder Reactor began powering itself in 1951. The first nuclear power plant designed to provide energy to a community was established in Obninsk, Russia, in 1954.

Building nuclear reactors requires a high level of technology, and only the countries that have signed the Nuclear Non-Proliferation Treaty can get the uranium or plutonium that is required. For these reasons, most nuclear power plants are located in the developed world.

Nuclear power plants produce renewable, clean energy. They do not pollute the air or release greenhouse gases. They can be built in urban or rural areas, and do not radically alter the environment around them.

The steam powering the turbines and generators is ultimately recycled. It is cooled down in a separate structure called a cooling tower. The steam turns back into water and can be used again to produce more electricity. Excess steam is simply recycled into the atmosphere, where it does little harm as clean water vapor.

However, the byproduct of nuclear energy is radioactive material. Radioactive material is a collection of unstable atomic nuclei. These nuclei lose their energy and can affect many materials around them, including organisms and the environment. Radioactive material can be extremely toxic, causing burns and increasing the risk for cancers, blood diseases, and bone decay.

Radioactive waste is what is left over from the operation of a nuclear reactor. Radioactive waste is mostly protective clothing worn by workers, tools, and any other material that have been in contact with radioactive dust. Radioactive waste is long-lasting. Materials like clothes and tools can stay radioactive for thousands of years. The government regulates how these materials are disposed of so they don't contaminate anything else.

Used fuel and rods of nuclear poison are extremely radioactive. The used uranium pellets must be stored in special containers that look like large swimming pools. Water cools the fuel and insulates the outside from contact with the radioactivity. Some nuclear plants store their used fuel in dry storage tanks above ground.

The storage sites for radioactive waste have become very controversial in the United States. For years, the government planned to construct an enormous nuclear waste facility near Yucca Mountain, Nevada, for instance. Environmental groups and local citizens protested the plan. They worried about radioactive waste leaking into the water supply and the Yucca Mountain environment, about 130 kilometers (80 miles) from the large urban area of Las Vegas, Nevada. Although the government began investigating the site in 1978, it stopped planning for a nuclear waste facility in Yucca Mountain in 2009.

''',"https://stackoverflow.com/questions/10654992/how-can-i-get-a-collection-of-keys-in-a-javascript-dictionary"]
}

import uvicorn
import openai
import numpy as np
from typing import Dict
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
# from gensim.summarization import keywords
from sumy.parsers.plaintext import PlaintextParser
from sumy.nlp.tokenizers import Tokenizer
# from sumy.summarizers.lsa import LsaSummarizer as Summarizer
from sumy.nlp.stemmers import Stemmer
from sumy.summarizers.lex_rank import LexRankSummarizer
# from sumy.summarizers.lsa import LsaSummarizer
from sumy.parsers.plaintext import PlaintextParser
from sumy.nlp.tokenizers import Tokenizer
# from sumy.summarizers.luhn import LuhnSummarizer
# from sumy.utils import get_stop_words
from sumy.summarizers.text_rank import TextRankSummarizer
from transformers import pipeline
from keybert import KeyBERT
from sklearn.feature_extraction.text import CountVectorizer
from sentence_transformers import SentenceTransformer
from numpy import dot
from numpy.linalg import norm

LANGUAGE = "english"
SENTENCES_COUNT = 10

stemmer = Stemmer(LANGUAGE)
# summarizer = Summarizer(stemmer)
# summarizer.stop_words = get_stop_words(LANGUAGE)

summarizer_lex = LexRankSummarizer()
# summarizer_lsa = LsaSummarizer()
# summarizer_1 = LuhnSummarizer()
summarizer_rank = TextRankSummarizer()
summarizer_t5 = pipeline("summarization", model='t5-base', tokenizer="t5-base", framework="pt", device=0)
kw_model = KeyBERT()
vectorizer = CountVectorizer(ngram_range=(1, 2))

openai.api_key = "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"
t5_emebd_gen =SentenceTransformer('sentence-transformers/sentence-t5-base')
    

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)


# def gen_total_summary(articles, max_token=120, min_token=10, SENTENCES_COUNT=10):
#     prompt = ''
#     for i in articles.values():
#         prompt+=i[0]
#         prompt+='\n'

    
#     summary = {}

#     try:
#         response = openai.Completion.create(
#                     model="text-davinci-003",
#                     prompt=prompt+"\n\nTl;dr",
#                     temperature=0.7,
#                     max_tokens=max_token,
#                     top_p=1,
#                     frequency_penalty=0,
#                     presence_penalty=1
#         )

#         r = response['choices']
#         # print(r,"\n\n\n", flush=True)
#         summary['openai'] = r[0]['text']

#     except Exception as err:
#         summary['openai'] = str(err)

#     parser = PlaintextParser.from_string(prompt, Tokenizer(LANGUAGE))



#     try:
#         summary['lex'] = ""
#         for sentence in summarizer_lex(parser.document, SENTENCES_COUNT):
#             summary['lex']+= "• "+str(sentence)+'\n'
#     except Exception as err:
#         summary['lex'] = str(err)

#     try:
#         summary['text_rank'] = ""
#         for sentence in summarizer_rank(parser.document, SENTENCES_COUNT):
#             summary['text_rank']+= "• "+str(sentence)+'\n'
#     except Exception as err:
#         summary['text_rank'] = str(err)

#     try:
#         summary['t5'] = summarizer_t5(prompt, min_length=min_token, max_length=max_token)[0]['summary_text']
#     except Exception as err:
#         summary['t5'] = str(err)

#     keywords = kw_model.extract_keywords(prompt, vectorizer=vectorizer)

#     summary['keywords'] = [i[0] for i in keywords]

#     summary['results'] = articles

#     return summary

def gen_summary_for(prompt, model="lex", max_token=120, min_token=10, SENTENCES_COUNT=10):
 
    summary = {}
    if model == "openai":
        try:
            response = openai.Completion.create(
                        model="text-davinci-003",
                        prompt=prompt+"\n\nTl;dr",
                        temperature=0.7,
                        max_tokens=max_token,
                        top_p=1,
                        frequency_penalty=0,
                        presence_penalty=1
            )

            r = response['choices']
            print(r,"\n\n\n", flush=True)
            summary['openai'] = r[0]['text']

        except Exception as err:
            summary['openai'] = str(err)

    else:

        parser = PlaintextParser.from_string(prompt, Tokenizer(LANGUAGE))
    # try:
    #     summary['lsa'] = []
    #     for sentence in summarizer(parser.document, SENTENCES_COUNT):
    #         summary['lsa'].append(str(sentence))

    # except Exception as err:
    #     summary['lsa'] = [str(err)]

        if model == 'lex':

            try:
                summary['lex'] = ""
                for sentence in summarizer_lex(parser.document, SENTENCES_COUNT):
                    summary['lex']+= "• "+str(sentence)+'\n'

            except Exception as err:
                summary['lex'] = str(err)

        # try:
        #     summary['lunh'] = []
        #     for sentence in summarizer_1(parser.document, SENTENCES_COUNT):
        #         summary['lunh'].append(str(sentence))

        # except Exception as err:
        #     summary['lunh'] = [str(err)]

        # try:
        #     summary['lsa'] = []
        #     for sentence in summarizer_lsa(parser.document, SENTENCES_COUNT):
        #         summary['lsa'].append(str(sentence))

        # except Exception as err:
        #     summary['lsa'] = [str(err)]
        elif model == 'text_rank':
            try:
                summary['text_rank'] = ""
                for sentence in summarizer_rank(parser.document, SENTENCES_COUNT):
                    summary['text_rank']+= "• "+str(sentence)+'\n'


            except Exception as err:
                summary['text_rank'] = str(err)

        elif model == 't5':
            try:
                summary['t5'] = summarizer_t5(prompt, min_length=min_token, max_length=max_token)[0]['summary_text']

            except Exception as err:
                summary['t5'] = str(err)

        else:
            print("Invalid model: ",model, flush=True)

    keywords = kw_model.extract_keywords(prompt, vectorizer=vectorizer)

    summary['keywords'] = [i[0] for i in keywords]

    return summary

def get_articles(prompt):
    return get_embeddings(articles)

def crawl_home_feed():
    return get_embeddings(articles)

def get_embeddings(results):
    each_article =[]
    for title in results:
        a = results[title][0]
        each_article.append(a)
        openai_response_emebd = openai.Embedding.create(input = [a.replace("\n", " ")], model="text-embedding-ada-002")['data'][0]['embedding']
        results[title].append([openai_response_emebd])

    t5_embeddings = t5_emebd_gen.encode(each_article)

    for i, title in enumerate(results):
        results[title][2].append(t5_embeddings[i].tolist())

    return results

@app.post('/search')
def search(json_data: Dict):
    # if Request.method == 'POST':
    print(json_data, flush=True)
    prompt = json_data['prompt']

    results = get_articles(prompt)
    print(results, flush=True)
    return results


@app.post('/get_summary')
def get_summary(json_data: Dict):
    # if Request.method == 'POST':
    print(json_data, flush=True)
    prompt = json_data['prompt']
    model = json_data['model']

    results = gen_summary_for(prompt, model)
    print(results, flush=True)
    return results


@app.post('/get_home_feed')
def get_home_feed():
    # if Request.method == 'POST':

    results = crawl_home_feed()
    print(results, flush=True)
    return results


@app.post('/get_scores')
def get_scores(json_data: Dict):
    # if Request.method == 'POST':
    query = json_data['query']
    results = json_data['results']

    rank = {}

    query_openai_emebd = np.asarray(openai.Embedding.create(input = [query.replace("\n", " ")], model="text-embedding-ada-002")['data'][0]['embedding'])
    query_t5_embeddings = np.asarray(t5_emebd_gen.encode([query])[0])

    for title in results:
        article_openai_emebd = results[title][2][0]
        article_t5_emebd = results[title][2][1]

        rank[title] = [dot(article_openai_emebd, query_openai_emebd)/(norm(article_openai_emebd)*norm(query_openai_emebd)),
                        dot(query_t5_embeddings, article_t5_emebd)/(norm(query_t5_embeddings)*norm(article_t5_emebd))]

    print(rank, flush=True)
    return rank

if __name__ == '__main__':
    uvicorn.run(app, port=5000)